// ============================================================================
// polyphoneDict.js (完整擴充版)
// 包含：變調、生活常用、國中文言文/詩詞、以及使用者指定擴充詞彙
// 依據 [Source 1] 國中小常用多音字表 順序製作
// ============================================================================

// 定義 IVS 選擇符
const IVS_2 = '\uDB40\uDDE1'; // 表中第 2 音
const IVS_3 = '\uDB40\uDDE2'; // 表中第 3 音
const IVS_4 = '\uDB40\uDDE3'; // 表中第 4 音

// ----------------------------------------------------------------------------
// 1. 【變調專區】 (一、不)
// ----------------------------------------------------------------------------
const SANDHI_WORDS = {
  // 「一」：遇四聲讀二聲 → ㄧˊ（IVS_2）
  '一個': `一${IVS_2}個`, '一次': `一${IVS_2}次`, '一定': `一${IVS_2}定`,
  '一半': `一${IVS_2}半`, '一樣': `一${IVS_2}樣`, '一陣': `一${IVS_2}陣`,
  '一切': `一${IVS_2}切`, '一塊': `一${IVS_2}塊`, '一部': `一${IVS_2}部`,
  '一共': `一${IVS_2}共`, '一再': `一${IVS_2}再`, '一下': `一${IVS_2}下`,

  // 「一」：遇 1/2/3 聲讀四聲 → ㄧˋ（IVS_3）
  '一直': `一${IVS_3}直`, '一起': `一${IVS_3}起`, '一天': `一${IVS_3}天`,
  '一生': `一${IVS_3}生`, '一般': `一${IVS_3}般`, '一些': `一${IVS_3}些`,
  '一點': `一${IVS_3}點`, '一隻': `一${IVS_3}隻`, '一邊': `一${IVS_3}邊`,
  '一本': `一${IVS_3}本`, '一種': `一${IVS_3}種`, '一條': `一${IVS_3}條`,

  // [擴充] 上一行/下一行：一(ㄧˋ=IVS_3) + 行(ㄏㄤˊ=IVS_2) [Cite: 1]
  '上一行': `上一${IVS_3}行${IVS_2}`,
  '下一行': `下一${IVS_3}行${IVS_2}`,

  // 「不」：遇四聲讀二聲 → ㄅㄨˊ（IVS_2）
  '不是': `不${IVS_2}是`, '不要': `不${IVS_2}要`, '不對': `不${IVS_2}對`,
  '不錯': `不${IVS_2}錯`, '不會': `不${IVS_2}會`, '不再': `不${IVS_2}再`,
  '不用': `不${IVS_2}用`, '不夠': `不${IVS_2}夠`, '不見': `不${IVS_2}見`,
  '不去': `不${IVS_2}去`, '不論': `不${IVS_2}論`, '不便': `不${IVS_2}便`,
};

// ----------------------------------------------------------------------------
// 2. 【國中小文言文、古詩詞專區】
// ----------------------------------------------------------------------------
const CLASSIC_TEXTS = {
  // --- 論 (ㄌㄨㄣˋ / ㄌㄨㄣˊ) ---
  '論語': `論${IVS_2}語`,

  // --- 樂 (ㄌㄜˋ / ㄩㄝˋ / ㄧㄠˋ) ---
  '樂山': `樂${IVS_3}山`,
  '樂水': `樂${IVS_3}水`,
  '禮樂': `禮樂${IVS_2}`,

  // --- 強 (ㄑㄧㄤˊ / ㄑㄧㄤˇ / ㄐㄧㄤˋ) ---
  '項為之強': `項為之強${IVS_3}`,

  // --- 否 (ㄈㄡˇ / ㄆㄧˇ) ---
  '臧否': `臧否${IVS_2}`,
  '否極泰來': `否${IVS_2}極泰來`,

  // --- 菲 (ㄈㄟ / ㄈㄟˇ) ---
  '妄自菲薄': `妄自菲${IVS_2}薄`,
  '菲薄': `菲${IVS_2}薄`,

  // --- 暴 (ㄅㄠˋ / ㄆㄨˋ) ---
  '一暴十寒': `一暴${IVS_2}十寒`,

  // --- 扁 (ㄅㄧㄢˇ / ㄆㄧㄢ) ---
  '扁舟': `扁${IVS_2}舟`,

  // --- 騎 (ㄑㄧˊ / ㄐㄧˋ) ---
  '千騎': `千騎${IVS_2}`,
  '鐵騎': `鐵騎${IVS_2}`,

  // --- 夫 (ㄈㄨ / ㄈㄨˊ) ---
  '逝者如斯夫': `逝者如斯夫${IVS_2}`,
  '夫天地者': `夫${IVS_2}天地者`,

  // --- 卷 (ㄐㄩㄢˋ / ㄐㄩㄢˇ / ㄑㄩㄢˊ) ---
  '漫卷': `漫卷${IVS_2}`,
  '卷土重來': `卷${IVS_2}土重來`,

  // --- 少 (ㄕㄠˇ / ㄕㄠˋ) ---
  '少年': `少${IVS_2}年`,
  '少女': `少${IVS_2}女`,
  '少壯': `少${IVS_2}壯`,
  '少婦': `少${IVS_2}婦`,
  '少時': `少${IVS_2}時`,

  // --- 創 (ㄔㄨㄤˋ / ㄔㄨㄤ) ---
  '創傷': `創${IVS_2}傷`,
  '重創': `重創${IVS_2}`,

  // --- 供 (ㄍㄨㄥ / ㄍㄨㄥˋ) ---
  '供桌': `供${IVS_2}桌`,
  '供品': `供${IVS_2}品`,
  '口供': `口供${IVS_2}`,

  // --- 衣 (ㄧ / ㄧˋ) ---
  '衣錦還鄉': `衣${IVS_2}錦還鄉`,
};

// ----------------------------------------------------------------------------
// 3. 【生活與校園常用多音字】 (包含擴充詞語)
// ----------------------------------------------------------------------------
const FREQUENT_WORDS = {
  // --- 覺 89BA ---
  '睡覺': `睡覺${IVS_2}`,
  '午覺': `午覺${IVS_2}`,
  '睡個覺': `睡個覺${IVS_2}`,

  // --- 處 8655 ---
  '學務處': `學務處${IVS_2}`,
  '教務處': `教務處${IVS_2}`,
  '總務處': `總務處${IVS_2}`,
  '輔導處': `輔導處${IVS_2}`,
  '訓導處': `訓導處${IVS_2}`,
  '人事處': `人事處${IVS_2}`,
  '住處': `住處${IVS_2}`,
  '好處': `好處${IVS_2}`,
  '壞處': `壞處${IVS_2}`,
  '長處': `長處${IVS_2}`,
  '短處': `短處${IVS_2}`,
  '難處': `難處${IVS_2}`,
  '用處': `用處${IVS_2}`,
  '到處': `到處${IVS_2}`,
  '處室': `處${IVS_2}室`,

  // --- 興 8208 ---
  '興奮': `興${IVS_2}奮`,
  '高興': `高興${IVS_2}`,
  '興趣': `興${IVS_2}趣`,
  '興致': `興${IVS_2}致`,
  '掃興': `掃興${IVS_2}`,
  '即興': `即興${IVS_2}`,

  // --- 重 91CD ---
  '重複': `重${IVS_2}複`,
  '重新': `重${IVS_2}新`,
  '重來': `重${IVS_2}來`,
  '重疊': `重${IVS_2}疊`,
  '重逢': `重${IVS_2}逢`,
  '重遊': `重${IVS_2}遊`,
  '重整': `重${IVS_2}整`,
  // [擴充] 重申、重頭 (ㄔㄨㄥˊ = IVS_2) [Cite: 1]
  '重申': `重${IVS_2}申`,
  '重頭': `重${IVS_2}頭`,

  // --- 長 9577 ---
  '校長': `校長${IVS_2}`,
  '家長': `家長${IVS_2}`,
  '學長': `學長${IVS_2}`,
  '班長': `班長${IVS_2}`,
  '組長': `組長${IVS_2}`,
  '師長': `師長${IVS_2}`,
  '村長': `村長${IVS_2}`,
  '市長': `市長${IVS_2}`,
  '長大': `長${IVS_2}大`,
  '成長': `成長${IVS_2}`,
  '長輩': `長${IVS_2}輩`,
  // [擴充] 長知識 (ㄓㄤˇ = IVS_2) [Cite: 1]
  '長知識': `長${IVS_2}知識`,

  // --- 樂 6A02 ---
  '音樂': `音樂${IVS_2}`,
  '樂器': `樂${IVS_2}器`,
  '樂隊': `樂${IVS_2}隊`,
  '國樂': `國樂${IVS_2}`,
  '弦樂': `弦樂${IVS_2}`,
  '管樂': `管樂${IVS_2}`,
  '奏樂': `奏樂${IVS_2}`,
  // [擴充] 樂聲、樂曲、樂手 (ㄩㄝˋ = IVS_2) [Cite: 1]
  '樂聲': `樂${IVS_2}聲`,
  '樂曲': `樂${IVS_2}曲`,
  '樂手': `樂${IVS_2}手`,

  // --- 朝 671D (ㄔㄠˊ / ㄓㄠ) ---
  // [Cite: 1] 表順序：ㄔㄠˊ(預設) / ㄓㄠ(IVS_2)
  // [擴充] 朝會 (ㄓㄠ = IVS_2)
  '朝會': `朝${IVS_2}會`,

  // --- 空 7A7A ---
  '有空': `有空${IVS_2}`,
  '沒空': `沒空${IVS_2}`,
  '空閒': `空${IVS_2}閒`,
  '空地': `空${IVS_2}地`,
  '空白': `空${IVS_2}白`,
  '填空': `填空${IVS_2}`,
  '空位': `空${IVS_2}位`,
  '空號': `空${IVS_2}號`,

  // --- 種 7A2E ---
  '種樹': `種${IVS_2}樹`,
  '種花': `種${IVS_2}花`,
  '耕種': `耕種${IVS_2}`,
  '接種': `接種${IVS_2}`,

  // --- 相 76F8 ---
  '相信': `相${IVS_2}信`,
  '相親': `相${IVS_2}親`,
  '相愛': `相${IVS_2}愛`,
  '相處': `相${IVS_2}處`, // IVS_2 + 處(ㄔㄨˇ)
  '互相': `互相${IVS_2}`,

  // --- 行 884C ---
  '銀行': `銀行${IVS_2}`,
  '行業': `行${IVS_2}業`,
  '行家': `行${IVS_2}家`,
  '外行': `外行${IVS_2}`,
  '內行': `內行${IVS_2}`,
  '車行': `車行${IVS_2}`,
  '排行榜': `排行${IVS_2}榜`,
  // [擴充] 行長: 行(ㄏㄤˊ=IVS_2) + 長(ㄓㄤˇ=IVS_2) [Cite: 1]
  '行長': `行${IVS_2}長${IVS_2}`,

  // --- 倒 5012 ---
  '跌倒': `跌倒${IVS_2}`,
  '滑倒': `滑倒${IVS_2}`,
  '絆倒': `絆倒${IVS_2}`,
  '推倒': `推倒${IVS_2}`,
  '倒閉': `倒${IVS_2}閉`,
  '倒楣': `倒${IVS_2}楣`,
  '倒霉': `倒${IVS_2}霉`,

  // --- 好 597D ---
  '好奇': `好${IVS_2}奇`,
  '好動': `好${IVS_2}動`,
  '好客': `好${IVS_2}客`,
  '好學': `好${IVS_2}學`,
  '愛好': `愛好${IVS_2}`,
  '嗜好': `嗜好${IVS_2}`,

  // --- 盛 76DB ---
  '盛大': `盛${IVS_2}大`,
  '盛開': `盛${IVS_2}開`,
  '茂盛': `茂盛${IVS_2}`,
  '豐盛': `豐盛${IVS_2}`,
  '強盛': `強盛${IVS_2}`,

  // --- 假 5047 ---
  '放假': `放假${IVS_2}`,
  '暑假': `暑假${IVS_2}`,
  '寒假': `寒假${IVS_2}`,
  '請假': `請假${IVS_2}`,
  '病假': `病假${IVS_2}`,
  '春假': `春假${IVS_2}`,
  '假期': `假${IVS_2}期`,

  // --- 差 5DEE ---
  '出差': `出差${IVS_2}`,
  '郵差': `郵差${IVS_2}`,
  '差事': `差${IVS_2}事`,

  // --- 便 4FBF ---
  '便宜': `便${IVS_2}宜`,

  // --- 將 5C07 ---
  '將領': `將${IVS_2}領`,
  '少將': `少將${IVS_2}`,
  '中將': `中將${IVS_2}`,
  '上將': `上將${IVS_2}`,
  '大將': `大將${IVS_2}`,
  '戰將': `戰將${IVS_2}`,
  '猛將': `猛將${IVS_2}`,
  
  // --- 強 5F37 (生活常用) ---
  '勉強': `勉強${IVS_2}`,
  '強迫': `強${IVS_2}迫`,
  '強詞奪理': `強${IVS_2}詞奪理`,
  '倔強': `倔強${IVS_3}`,
  // [擴充] 強調: 強(ㄑㄧㄤˊ=預設) + 調(ㄉㄧㄠˋ=IVS_2) [Cite: 1]
  '強調': `強調${IVS_2}`,

  // --- 會 6703 ---
  '會計': `會${IVS_2}計`,
  
  // --- 為 70BA ---
  '因為': `因為${IVS_2}`,
  '為了': `為${IVS_2}了`,
  '為什麼': `為${IVS_2}什麼`,
};

// ============================================================================
// 匯出模組
// ============================================================================
export const POLYPHONE_MAP = {
  ...SANDHI_WORDS,
  ...CLASSIC_TEXTS,
  ...FREQUENT_WORDS,
};

// 排序邏輯：字數長度優先（防止「一行」被「一」優先取代）
export const SORTED_POLYPHONE_KEYS = Object.keys(POLYPHONE_MAP).sort((a, b) => b.length - a.length);

export const fixPolyphones = (text) => {
  if (!text || typeof text !== 'string') return text;
  
  let fixedText = text;
  
  SORTED_POLYPHONE_KEYS.forEach(word => {
    if (fixedText.includes(word)) {
      const replacement = POLYPHONE_MAP[word];
      fixedText = fixedText.split(word).join(replacement);
    }
  });
  
  return fixedText;
};